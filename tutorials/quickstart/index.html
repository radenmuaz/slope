<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://radenmuaz.github.io/slope/tutorials/quickstart/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Quickstart - Slope</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Quickstart";
        var mkdocs_page_input_path = "tutorials/quickstart.md";
        var mkdocs_page_url = "/slope/tutorials/quickstart/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Slope
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">SlopeAD</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Api</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Slope</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/slope/core/">slope.core</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_backend/">Adding new backend</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../internals_walkthrough/">Internals walkthrough</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Quickstart</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#environment-flags">Environment flags</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../training_nn/">Training nn</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Slope</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tutorials</li>
      <li class="breadcrumb-item active">Quickstart</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="quickstart">Quickstart</h1>
<p>There are many examples in <a href="examples/">examples/</a> folder.</p>
<p>We start by running MNIST classifier training, <a href="examples/nn/mnist_mlp.py">examples/nn/mnist_mlp.py</a></p>
<pre><code class="language-sh">python examples/nn/mnist_mlp.py
</code></pre>
<pre><code class="language-sh">Starting training...
...
Train epoch: 2, batch: 299/300, loss: 12.51: 100%|██████████████████████████████████████████████████████████████████████| 300/300 [00:02&lt;00:00, 139.36it/s]
Epoch 2 in 2.15 sec
Test set accuracy 0.97
</code></pre>
<p>By setting the <code>SLOPE_BACKEND</code> flag, we change the backend to either <code>iree</code> (default), <code>onnxruntime</code> and <code>numpy</code>.
We can also set <code>LOG_JIT=1</code> to verbose print the backend output.</p>
<pre><code class="language-sh">LOG_JIT=1 SLOPE_BACKEND=onnxruntime python examples/nn/mnist_mlp.py
</code></pre>
<pre><code class="language-sh">...

---- train_step codegen:

&lt;ir_version: 7, opset_import: [&quot;&quot; : 18, &quot;slope&quot;:1]&gt;
main (float[100, 784] x0, float[10, 100] x1, float[200, 28, 28] x2, float[200, 10] x3, int32[] x4, float[100, 784] x5, float[10, 100] x6, float[] x7) =&gt; (float[] y0, float[100, 784] y2, float[10, 100] y4, int32[] y5, float[100, 784] y1, float[10, 100] y3, float[] x7)
{

    z0_shape = Constant &lt;value = int64[2] { 200, 784 } &gt;()
    z0 = Reshape(x2, z0_shape)
...
    y4 = Sub(x1, z164)
    z165_fill_value = Constant &lt; value = int32[1] { 1 }&gt;()
    z165_squeeze_dim = Constant &lt;value = int64[1] {0}&gt; ()
    z165 = Squeeze (z165_fill_value, z165_squeeze_dim)

    y5 = Add(x4, z165)
}
...

===============

Train epoch: 0, batch: 58/300, loss: 71.23:  20%|██████████████▎                                                          | 59/300 [00:01&lt;00:04, 55.45it/s]
</code></pre>
<h3 id="environment-flags">Environment flags</h3>
<p>put this before the command to set</p>
<pre><code># prints the jitted code
LOG_JIT=1 

# set device
DEFAULT_DEVICE=cpu
DEFAULT_DEVICE=cuda
DEFAULT_DEVICE=metal

# set backend
SLOPE_BACKEND=iree # iree backend (default)
SLOPE_BACKEND=onnxruntime # onnxruntime backend
SLOPE_BACKEND=numpy # numpy backend (extremely SLOW)
</code></pre>
<h1 id="slope-internals-tutorial">Slope internals tutorial</h1>
<h2 id="slope-has-familiar-pytorch-like-syntax">Slope has familiar Pytorch-like syntax</h2>
<p>Most of the things familiar in Pytorch works in Slope, probably.</p>
<pre><code class="language-python">import slope
x = slope.ones(2, 5)
w = slope.arange(15, dtype=slope.float32).reshape(5,3)
b = slope.tensor([1., 2., 3.], dtype=slope.float32)
y = x @ w + b
print(y)
</code></pre>
<h2 id="every-operations-are-compiled-with-slopejit">Every operations are compiled with slope.jit</h2>
<p>Operation calls are jitted as individual programs eagerly.
Try running this on terminal:</p>
<pre><code class="language-sh">LOG_JIT=1 python -c &quot;import slope; print(slope.ones(3)*2)&quot;
</code></pre>
<pre><code class="language-sh">...
---- full_shape__lp__rp__fill_value_2_dt_0_dtype_&lt;DType:float32&gt;_device_&lt;Device:'cpu:0'&gt;_ codegen:

func.func @main () -&gt; (tensor&lt;f32&gt;)
{
    %y0 = &quot;stablehlo.constant&quot;() { value = dense&lt;2.0&gt; : tensor&lt;f32&gt; } : () -&gt; (tensor&lt;f32&gt;)
    &quot;func.return&quot;(%y0): (tensor&lt;f32&gt;) -&gt; ()
}
... # plenty of outputs
....
</code></pre>
<p>To prevent eager jit, write code in function and use slope.jit.
Then call the function</p>
<pre><code class="language-python">@slope.jit
def f(x):
    y = x * x
    return y
# Alternative way to jit
# f = slope.jit(f)

x = slope.full((1,), 2.)
y = f(x)
print(y)
</code></pre>
<p>To see the actual code:</p>
<pre><code class="language-python">jit_object = f.lower(x)
# slope Program intermediate representation
print(jit_object.program)
# backend code
print(jit_object.code)
</code></pre>
<pre><code class="language-sh">def f(x0): # [1, f32] -&gt; [1, f32]
    y0 = slope.mul(x0, x0) # ([1, f32], [1, f32]) -&gt; [1, f32]
    return y0
</code></pre>
<pre><code class="language-sh">
func.func @main (%x0: tensor&lt;1xf32&gt;) -&gt; (tensor&lt;1xf32&gt;)
{
    %y0 = &quot;stablehlo.multiply&quot;(%x0, %x0) : (tensor&lt;1xf32&gt;,tensor&lt;1xf32&gt;) -&gt; (tensor&lt;1xf32&gt;)
    &quot;func.return&quot;(%y0): (tensor&lt;1xf32&gt;) -&gt; ()
}
</code></pre>
<h1 id="derivatives-and-gradients">Derivatives and gradients</h1>
<p>Slope has several AD functions, like <code>slope.jvp</code> <code>slope.vjp</code> and <code>slope.grad</code></p>
<p>To do the usual backprop things:</p>
<pre><code class="language-python">def f(x, w):
    y = x @ w
    return y
def loss_fn(x, w, y):
    y_hat = f(x,w)
    return ((y_hat - y)**2).sum()
gloss_fn = slope.value_and_grad(loss_fn, argnums=(1,))

@slope.jit
def train_step(x, w, y, lr):
    loss, gw = gloss_fn(x, w, y)
    w = w - lr * gw
    return loss, w

N = 50
x = slope.randn(N, 2)
y = slope.randn(N, 1)
w = slope.randn(2, 1)
lr = slope.tensor([0.001])
for i in range(10):
    loss, w = train_step(x, w, y, lr)
    print(i, loss.numpy())

</code></pre>
<pre><code>0 102.412125
1 88.60157
2 78.322815
3 70.644066
4 64.883766
5 60.54294
6 57.25553
7 54.75257
8 52.83598
9 51.359528
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../internals_walkthrough/" class="btn btn-neutral float-left" title="Internals walkthrough"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../training_nn/" class="btn btn-neutral float-right" title="Training nn">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../internals_walkthrough/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../training_nn/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
